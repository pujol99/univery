<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="/static/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <title>Univery | {{title}}</title>
    <link rel="icon" href="../static/web_pics/done.png">
</head>

<body>
    <header class="secondary-header">
        <div class="mycontainer left">
            <ul>
                <li><a id="logo" class="link" href="{{ url_for('main.home') }}">Univery</a></li>
            </ul>
        </div>
        <div class="mycontainer right">
            <ul>
                {% if current_user.is_authenticated %}
                <li><a class="link" href="{{ url_for('deliveries.calendar') }}">Calendar</a></li>
                <li><a class="link" href="{{ url_for('deliveries.add_delivery') }}">Add delivery</a></li>
                <li><a class="link" href="{{ url_for('subjects.subjects_page') }}">Subjects</a></li>
                <li><a class="link" href="{{ url_for('users.account') }}">Account</a></li>
                {% else %}
                <li><a class="link" href="{{ url_for('users.login') }}">Login</a></li>
                <li><a class="link" href="{{ url_for('users.register') }}">Register</a></li>
                {% endif %}
            </ul>
        </div>
    </header>
    {% block content %}{% endblock %}
</body>

</html>
<script src="/static/scripts.js"></script>
<script>
    var waitin = document.getElementById('waiting');
    var loadin = document.getElementById('loading');
    var popup = document.getElementById('popup');
    var popupColor = document.getElementById('popup-colors');
    var popupColorTrigger = document.getElementById('colors-btn');

    var closePopupBool = false;

    loadin.style.display = "none";
    popup.style.display = "none";
    popupColor.style.display = "none";

    document.getElementById('refresh-text').onclick = function () {
        waitin.style.display = "none";
        loadin.style.display = "block";
    }

    $(function() {
        $("body").click(function(e) {
            if(popup.style.display === "block"){
                if (!(e.target.id == "popup" || $(e.target).parents("#popup").length)) {
                    if(closePopupBool){
                        popup.style.display = "none";
                        closePopupBool = false;
                    }else{
                        closePopupBool = true;
                    }
                }
            }
        });
    })

    function deliveryType () {
        var dropdown_value = document.getElementById("delivery-type").value;
        if(dropdown_value === "undone"){
            window.location = "/";
        }else if(dropdown_value === "done"){
            window.location = "/done";
        }else{
            window.location = "/removed";
        }
    }

    function openPopup (delivery, next) {
        document.getElementById('popup').style.display = "block";
        document.getElementById('popup-name').textContent = delivery[0];
        document.getElementById('popup-subject').textContent = delivery[5];
        document.getElementById('popup-descr').textContent = delivery[1].replaceAll("~", "\n");
        document.getElementById('popup-date').textContent = delivery[2];
        if(delivery[4] === "Done"){
            document.getElementById('popup-done-div').style.display = "block";
            document.getElementById('popup-undone-div').style.display = "none";
            document.getElementById('popup-delete-div').style.display = "block";
            document.getElementById('popup-restore-div').style.display = "none";
            
            var textDone = document.getElementById('popup-done').href;
            var textDoneID = textDone.slice(0, textDone.length-1) + delivery[7].toString() + '?next=%2F' + next;
            document.getElementById('popup-done').href = textDoneID;

            var textDelete = document.getElementById('popup-delete').href;
            var textDeleteID = textDelete.slice(0, textDelete.length-1) + delivery[7].toString() + '?next=%2F' + next;
            document.getElementById('popup-delete').href = textDeleteID;
        }else if(delivery[4] === "Undone"){
            document.getElementById('popup-done-div').style.display = "none";
            document.getElementById('popup-undone-div').style.display = "block";
            document.getElementById('popup-delete-div').style.display = "block";
            document.getElementById('popup-restore-div').style.display = "none";

            var textDone = document.getElementById('popup-undone').href;
            var textDoneID = textDone.slice(0, textDone.length-1) + delivery[7].toString();
            document.getElementById('popup-undone').href = textDoneID;

            var textDelete = document.getElementById('popup-delete').href;
            var textDeleteID = textDelete.slice(0, textDelete.length-1) + delivery[7].toString();
            document.getElementById('popup-delete').href = textDeleteID;
        }else{
            document.getElementById('popup-done-div').style.display = "none";
            document.getElementById('popup-undone-div').style.display = "none";
            document.getElementById('popup-delete-div').style.display = "none";
            document.getElementById('popup-restore-div').style.display = "block";

            var textDelete = document.getElementById('popup-restore').href;
            var textDeleteID = textDelete.slice(0, textDelete.length-1) + delivery[7].toString();
            document.getElementById('popup-restore').href = textDeleteID;
        }
        
        
        if(delivery[3] === "None"){
            document.getElementById('show-url').style.display = "none";
        }else{
            document.getElementById('popup-url').href = delivery[3];
            document.getElementById('show-url').style.display = "block";
        }
    }

    function randomColor() {
        var color = document.getElementById('color-content');

        color.value = Math.floor(Math.random()*16777215).toString(16);
        color.style.backgroundColor = color.value;
    }

    popupColorTrigger.onmouseover = function () {
        popupColor.style.display = "block";
    };
    popupColorTrigger.onmouseout = function () {
        popupColor.style.display = "none";
    };
</script>
</html>